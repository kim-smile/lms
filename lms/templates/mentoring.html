{% extends "base.html" %}
{% block title %}ë©˜í† ë§{% endblock %}
{% block header %}ë©˜í† ë§ í—ˆë¸Œ{% endblock %}

{% block content %}
<div class="tabs">
  <a class="tab {{ 'active' if tab=='reports' }}" href="?tab=reports">ë³´ê³ ì„œ</a>
  <a class="tab {{ 'active' if tab=='teams' }}" href="?tab=teams">íŒ€ì› ê´€ë¦¬</a>
  <a class="tab {{ 'active' if tab=='projects' }}" href="?tab=projects">í”„ë¡œì íŠ¸/ì‘ì—…</a>
  <a class="tab {{ 'active' if tab=='competitions' }}" href="?tab=competitions">ê³µëª¨ì „</a>
  <a class="tab {{ 'active' if tab=='github' }}" href="?tab=github">GitHub ì—°ë™</a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if tab == 'reports' %}
  <div class="grid2">
    <div class="card">
      <div class="title">ìƒˆ ë³´ê³ ì„œ</div>
      <form method="post" action="{{ url_for('mentoring_report_new') }}" enctype="multipart/form-data">
        <div class="row"><label>ì œëª©</label><input name="title" required></div>
        <div class="row"><label>ë‚´ìš©</label><textarea name="content" rows="5"></textarea></div>
        <div class="row">
          <label>íŒ€(ì„ íƒ)</label>
          <select name="team_id">
            <option value="">ê°œì¸</option>
            {% for t in my_teams %}<option value="{{ t.id }}">{{ t.name }}</option>{% endfor %}
          </select>
        </div>
        <div class="row"><label>íŒŒì¼</label><input type="file" name="file"></div>
        <div class="actions"><button class="btn primary">ë“±ë¡</button></div>
      </form>
    </div>
    <div class="card">
      <div class="title">ë‚´ ë³´ê³ ì„œ</div>
      <ul class="list">
        {% for r in my_reports %}
        <li>
          <b>{{ r.title }}</b>
          <span class="muted"> Â· {{ r.created_at|dt_kr }}</span>
          {% if r.team %}<span class="muted"> Â· íŒ€: {{ r.team.name }}</span>{% endif %}
          {% if r.file_url %} Â· <a href="{{ r.file_url }}" target="_blank">ì²¨ë¶€</a>{% endif %}
          <div class="muted">{{ (r.content or '')[:120] }}{% if r.content and r.content|length>120 %}â€¦{% endif %}</div>
        </li>
        {% else %}
        <li class="muted">ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

{% elif tab == 'teams' %}
  <div class="grid2">
    <div class="card">
      <div class="title">íŒ€ ìƒì„±</div>
      <form method="post" action="{{ url_for('mentoring_team_new') }}">
        <div class="row"><label>íŒ€ ì´ë¦„</label><input name="name" required></div>
        <div class="row"><label></label><label><input type="checkbox" name="is_solo"> ê°œì¸ ë‹¨ë… íŒ€</label></div>
        <div class="actions"><button class="btn primary">ìƒì„±</button></div>
      </form>
    </div>
    <div class="card">
      <div class="title">íŒ€ ì°¸ì—¬</div>
      <form method="post" action="{{ url_for('mentoring_team_join') }}">
        <div class="row"><label>íŒ€ ID</label><input name="team_id" placeholder="ì˜ˆ: 3" required></div>
        <div class="actions"><button class="btn primary">ì°¸ì—¬</button></div>
      </form>
      <hr>
      <div class="title">ë‚´ íŒ€</div>
      <ul class="list">
        {% for t in my_teams %}
          <li>#{{ t.id }} Â· <b>{{ t.name }}</b>{% if t.is_solo %} <span class="muted">(ê°œì¸)</span>{% endif %}</li>
        {% else %}
          <li class="muted">ì°¸ì—¬í•œ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

{% elif tab == 'projects' %}
  <div class="card">
    <div class="title">ìƒˆ í”„ë¡œì íŠ¸</div>
    <form method="post" action="{{ url_for('mentoring_project_new') }}">
      <div class="row"><label>ì œëª©</label><input name="title" required></div>
      <div class="row"><label>ì„¤ëª…</label><textarea name="description" rows="4"></textarea></div>
      <div class="row">
        <label>íŒ€(ì„ íƒ)</label>
        <select name="team_id">
          <option value="">ê°œì¸ í”„ë¡œì íŠ¸</option>
          {% for t in my_teams %}<option value="{{ t.id }}">{{ t.name }}</option>{% endfor %}
        </select>
      </div>
      <div class="row"><label>GitHub</label><input name="github" placeholder="https://github.com/org/repo"></div>
      <div class="actions"><button class="btn primary">ìƒì„±</button></div>
    </form>
  </div>

  <div class="grid2">
    {% for p in my_projects %}
    <div class="card">
      <div class="row">
        <b>{{ p.title }}</b>
        <span class="muted">{{ p.status }}</span>
      </div>
      <div class="muted">{{ (p.description or '')[:140] }}{% if p.description and p.description|length>140 %}â€¦{% endif %}</div>
      {% if p.github_repo_url %}<div class="kv">ğŸ”— <a href="{{ p.github_repo_url }}" target="_blank">{{ p.github_repo_url }}</a></div>{% endif %}
      <div class="title" style="margin-top:10px;">ì‘ì—… ì¶”ê°€</div>
      <form method="post" action="{{ url_for('mentoring_task_new') }}">
        <input type="hidden" name="project_id" value="{{ p.id }}">
        <div class="row"><label>ì œëª©</label><input name="title" required></div>
        <div class="row"><label>ë§ˆê°</label><input name="due_at" placeholder="YYYY-MM-DD HH:MM"></div>
        <div class="row"><label>ë‹´ë‹¹ìID</label><input name="assignee_id" placeholder="ì„ íƒ"></div>
        <div class="actions"><button class="btn">ì¶”ê°€</button></div>
      </form>
      <div class="title" style="margin-top:8px;">ì‘ì—… ëª©ë¡</div>
      <ul class="list">
        {% for t in p.tasks %}
          <li>â€¢ {{ t.title }} <span class="muted">
            {% if t.due_at %} Â· {{ t.due_at|dt_kr }}{% endif %}
            {% if t.assignee %} Â· ë‹´ë‹¹: {{ t.assignee.name }}{% endif %}
            Â· {{ t.status }}
          </span></li>
        {% else %}
          <li class="muted">ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
      </ul>
    </div>
    {% else %}
      <div class="muted">í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    {% endfor %}
  </div>

{% elif tab == 'competitions' %}
  <div class="grid2">
    <div class="card">
      <div class="title">ê³µëª¨ì „ ë“±ë¡(ê´€ë¦¬/êµìˆ˜ìš©)</div>
      <form method="post" action="{{ url_for('mentoring_comp_new') }}">
        <div class="row"><label>ì œëª©</label><input name="title" required></div>
        <div class="row"><label>ì£¼ìµœ</label><input name="host"></div>
        <div class="row"><label>URL</label><input name="url"></div>
        <div class="row"><label>ë§ˆê°</label><input name="apply_deadline" placeholder="YYYY-MM-DD HH:MM"></div>
        <div class="actions"><button class="btn">ë“±ë¡</button></div>
      </form>
    </div>
    <div class="card">
      <div class="title">ê³µëª¨ì „ ì‹ ì²­</div>
      <form method="post" action="{{ url_for('mentoring_comp_apply') }}">
        <div class="row">
          <label>ê³µëª¨ì „</label>
          <select name="competition_id" required>
            {% for c in comps %}
              <option value="{{ c.id }}">{{ c.title }}{% if c.apply_deadline %} Â· ë§ˆê° {{ c.apply_deadline|dt_kr }}{% endif %}</option>
            {% endfor %}
          </select>
        </div>
        <div class="row">
          <label>íŒ€(ì„ íƒ)</label>
          <select name="team_id">
            <option value="">ê°œì¸ ì‹ ì²­</option>
            {% for t in my_teams %}<option value="{{ t.id }}">{{ t.name }}</option>{% endfor %}
          </select>
        </div>
        <div class="row">
          <label>í”„ë¡œì íŠ¸(ì„ íƒ)</label>
          <select name="project_id">
            <option value="">ë¯¸ì§€ì •</option>
            {% for p in my_projects %}<option value="{{ p.id }}">{{ p.title }}</option>{% endfor %}
          </select>
        </div>
        <div class="actions"><button class="btn primary">ì‹ ì²­</button></div>
      </form>
      <div class="title" style="margin-top:12px;">ë‚´ ì‹ ì²­ ë‚´ì—­</div>
      <ul class="list">
        {% for e in my_entries %}
          <li>#{{ e.id }} Â· {{ e.competition.title }} <span class="muted">Â· {{ e.status }}</span></li>
        {% else %}
          <li class="muted">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

{% else %} {# github #}
  <div class="card">
    <div class="title">GitHub ì—°ë™</div>
    <p class="muted">
      ê°„ë‹¨íˆ <b>í”„ë¡œì íŠ¸ì— ë ˆí¬ì§€í† ë¦¬ URL</b>ì„ ì €ì¥/ê³µìœ í•©ë‹ˆë‹¤. í–¥í›„ WebhookÂ·ì´ìŠˆ ë™ê¸°í™”ê¹Œì§€ í™•ì¥ ê°€ëŠ¥.
      í”„ë¡œì íŠ¸ íƒ­ì—ì„œ ê° í”„ë¡œì íŠ¸ì˜ <i>GitHub</i> URLì„ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.
    </p>
    <ul class="list">
      {% for p in my_projects if p.github_repo_url %}
        <li><b>{{ p.title }}</b> â€” <a href="{{ p.github_repo_url }}" target="_blank">{{ p.github_repo_url }}</a></li>
      {% else %}
        <li class="muted">ì—°ë™ëœ ë ˆí¬ê°€ ì—†ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ìƒì„± ì‹œ GitHub URLì„ ë„£ì–´ë³´ì„¸ìš”.</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}
{% endblock %}