{% extends "base.html" %}
{% block title %}일정{% endblock %}
{% block header %}일정{% endblock %}
{% block content %}

<div class="tabs">
  <form method="get" action="{{ url_for('schedule_page') }}" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
    <span class="muted">기간:</span>
    <input type="date" name="start" value="{{ start.strftime('%Y-%m-%d') }}" />
    <span>~</span>
    <input type="date" name="end" value="{{ end.strftime('%Y-%m-%d') }}" />
    <label style="display:flex; align-items:center; gap:6px;">
      <input type="checkbox" name="assign" value="1" {% if include_assign %}checked{% endif %}> 과제 마감 포함
    </label>
    <input name="q" value="{{ q }}" placeholder="제목/장소/설명 검색" style="padding:6px 10px; border:1px solid var(--border); border-radius:8px;">
    <button class="btn">필터</button>
  </form>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="grid2">
  <div class="card">
    <div class="title">새 일정 추가</div>
    <form method="post" action="{{ url_for('schedule_new') }}">
      <div class="row"><label>제목</label><input name="title" required placeholder="예: 팀 미팅"></div>
      <div class="row"><label>시작</label><input type="datetime-local" name="start_at" required></div>
      <div class="row"><label>종료</label><input type="datetime-local" name="end_at"></div>
      <div class="row"><label>장소</label><input name="location" placeholder="예: H-301"></div>
      <div class="row">
        <label>종류</label>
        <select name="kind">
          <option value="event">일반</option>
          <option value="mentoring">멘토링</option>
          <option value="meeting">미팅</option>
          <option value="exam">시험</option>
        </select>
      </div>
      <div class="row">
        <label>강좌(선택)</label>
        <select name="course_id">
          <option value="">연결 안 함</option>
          {% for c in courses %}<option value="{{ c.id }}">{{ c.title }}</option>{% endfor %}
        </select>
      </div>
      <div class="row"><label>설명</label><textarea name="description" rows="3"></textarea></div>
      <div class="actions"><button class="btn primary">등록</button></div>
    </form>
  </div>

  <div class="card">
    <div class="title">일정 목록 ({{ start|ymd_kr }} ~ {{ end|ymd_kr }})</div>
    <table class="tbl">
      <thead><tr><th>일시</th><th>제목</th><th>종류</th><th>강좌</th><th>장소</th><th></th></tr></thead>
      <tbody>
        {% for it in items %}
        <tr>
          <td>
            {% if it.start %}{{ it.start|dt_kr }}{% endif %}
            {% if it.end %} ~ {{ it.end|dt_kr }}{% endif %}
          </td>
          <td><b>{{ it.title }}</b></td>
          <td>
            {% if it.kind == 'assignment' %}
              <span class="chip chip-ok">과제 마감</span>
            {% elif it.kind == 'mentoring' %}
              <span class="chip">멘토링</span>
            {% elif it.kind == 'exam' %}
              <span class="chip">시험</span>
            {% elif it.kind == 'meeting' %}
              <span class="chip">미팅</span>
            {% else %}
              <span class="chip">일정</span>
            {% endif %}
          </td>
          <td class="muted">{{ it.course or '-' }}</td>
          <td class="muted">{{ it.location or '-' }}</td>
          <td class="right">
            {% if it.is_event and it.id %}
            <form method="post" action="{{ url_for('schedule_delete', event_id=it.id) }}">
              <button class="btn">삭제</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% else %}
          <tr><td colspan="6" class="muted">표시할 일정이 없습니다.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}