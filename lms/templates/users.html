{% extends "base.html" %}
{% block title %}ì‚¬ìš©ì ê´€ë¦¬ Â· LMS{% endblock %}

{% block content %}
  <h1 class="page-title">ì‚¬ìš©ì ê´€ë¦¬</h1>
  <p class="subtitle">ì‹œìŠ¤í…œ ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•˜ê³  ê¶Œí•œì„ ì„¤ì •í•˜ì„¸ìš”.</p>

  <!-- KPI -->
  <div class="grid grid-4 kpi-row">
    <section class="card kpi">
      <div class="kpi-label">ì „ì²´ ì‚¬ìš©ì</div>
      <div class="kpi-value">{{ total_cnt }}</div>
    </section>
    <section class="card kpi">
      <div class="kpi-label">í•™ìƒ</div>
      <div class="kpi-value">{{ student_cnt }}</div>
    </section>
    <section class="card kpi">
      <div class="kpi-label">êµìˆ˜</div>
      <div class="kpi-value">{{ instructor_cnt }}</div>
    </section>
    <section class="card kpi">
      <div class="kpi-label">ê´€ë¦¬ì</div>
      <div class="kpi-value">{{ admin_cnt }}</div>
    </section>
  </div>

  <!-- ê²€ìƒ‰/í•„í„° -->
  <form class="toolbar" method="get" action="">
    <label class="sr-only" for="q">ê²€ìƒ‰ì–´</label>
    <input id="q" class="search" type="text" name="q" placeholder="ì‚¬ìš©ìëª…, ì´ë¦„, ì´ë©”ì¼ë¡œ ê²€ìƒ‰â€¦" value="{{ q }}">
    <label class="sr-only" for="role">ì—­í• </label>
    <select id="role" name="role" class="select" aria-label="ì—­í•  í•„í„°">
      <option value="all"        {{ 'selected' if role == 'all' else '' }}>ëª¨ë“  ì—­í• </option>
      <option value="student"    {{ 'selected' if role == 'student' else '' }}>í•™ìƒ</option>
      <option value="instructor" {{ 'selected' if role == 'instructor' else '' }}>êµìˆ˜</option>
      <option value="admin"      {{ 'selected' if role == 'admin' else '' }}>ê´€ë¦¬ì</option>
    </select>
    <button class="btn" type="submit" aria-label="ê²€ìƒ‰">ê²€ìƒ‰</button>
  </form>

  <!-- ì‚¬ìš©ì ëª©ë¡ -->
  <section class="card">
    <div class="card-title">ì‚¬ìš©ì ëª©ë¡</div>
    <p class="muted small">ë“±ë¡ëœ ì‚¬ìš©ìë“¤ì˜ ì •ë³´ì™€ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>

    {% if users and users|length %}
      {% for u in users %}
        <div class="user-row" aria-label="ì‚¬ìš©ì">
          <div class="avatar" aria-hidden="true">{{ (u.name|default(''))[:1] }}</div>

          <div class="u-main">
            <div class="u-name">
              {{ u.name }}
              <span class="handle">@{{ u.username or ('user' ~ u.id) }}</span>
            </div>
            <div class="u-meta">
              <span class="meta-item" title="ì´ë©”ì¼">
                <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M2 4h20v16H2z" fill="none" stroke="currentColor"/></svg>
                {{ u.email }}
              </span>

              {% if u.phone %}
                <span class="meta-item" title="ì „í™”ë²ˆí˜¸">
                  <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 3.1 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.12.9.33 1.77.62 2.6a2 2 0 0 1-.45 2.11L9 10a16 16 0 0 0 5 5l.57-1.17a2 2 0 0 1 2.11-.45c.83.29 1.7.5 2.6.62A2 2 0 0 1 22 16.92z" fill="none" stroke="currentColor"/></svg>
                  {{ u.phone }}
                </span>
              {% endif %}

              <span class="meta-item" title="ê°€ì…ì¼">
                ê°€ì…: {{ u.created_at|ymd_kr }}
              </span>
            </div>
          </div>

          <div class="u-tags">
            {% set role_label = (u.role or 'student') %}
            {% if role_label == 'admin' %}
              <span class="badge danger">ê´€ë¦¬ì</span>
            {% elif role_label == 'instructor' %}
              <span class="badge dark">êµìˆ˜</span>
            {% else %}
              <span class="badge">í•™ìƒ</span>
            {% endif %}

            {% set active_flag = (u.is_active | default(true)) %}
            {% if active_flag %}
              <span class="badge success">í™œì„±</span>
            {% else %}
              <span class="badge muted">ë¹„í™œì„±</span>
            {% endif %}
          </div>

          <div class="u-actions">
            <button class="icon-btn" type="button" title="í¸ì§‘" aria-label="{{ u.name }} í¸ì§‘">âœï¸</button>
            <button class="icon-btn" type="button" title="ì‚­ì œ" aria-label="{{ u.name }} ì‚­ì œ">ğŸ—‘ï¸</button>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="muted">í‘œì‹œí•  ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    {% endif %}
  </section>
{% endblock %}