{% extends 'base.html' %}

{% block content %}
  <!-- Page header -->
  <h1 class="page-title">대시보드</h1>
  <p class="subtitle">학습 현황과 최근 활동을 한눈에 확인하세요.</p>

  <!-- KPIs -->
  <section class="grid grid-4">
    <div class="card kpi" aria-label="과제 진행률">
      <div class="kpi-label">과제 진행률</div>
      <div class="kpi-value">{{ progress_pct }}%</div>
      <div class="kpi-sub">{{ submitted_cnt }}/{{ total_cnt }} 완료</div>
    </div>

    <div class="card kpi" aria-label="평균 성적">
      <div class="kpi-label">평균 성적</div>
      <div class="kpi-value">{{ avg_score if avg_score is not none else '—' }}</div>
      <div class="kpi-sub">전체 과목 평균</div>
    </div>

    <div class="card kpi" aria-label="수강 강좌 수">
      <div class="kpi-label">수강 강좌</div>
      <div class="kpi-value">{{ course_count }}</div>
      <div class="kpi-sub">현재 등록 강좌</div>
    </div>

    <div class="card kpi" aria-label="제출 현황">
      <div class="kpi-label">제출 현황</div>
      <div class="kpi-value">{{ submitted_cnt }}</div>
      <div class="kpi-sub">총 {{ total_cnt }}개 중</div>
    </div>
  </section>

  <!-- 최근 강좌 (진행 바) -->
  <section class="card" aria-labelledby="recent-courses-title">
    <div id="recent-courses-title" class="card-title">최근 강좌</div>

    {% if bars and bars|length %}
      {% for b in bars %}
        <div class="course-row">
          <div class="title" title="{{ b.course.title }}">{{ b.course.title }}</div>
          <div class="bar" role="progressbar" aria-valuenow="{{ b.pct }}" aria-valuemin="0" aria-valuemax="100">
            <span style="width: '{{ b.pct }}%;'"></span>
          </div>
          <div class="pct">{{ b.pct }}%</div>
        </div>
      {% endfor %}
    {% else %}
      <div class="muted">수강 중인 강좌가 없습니다.</div>
    {% endif %}
  </section>

  <div class="grid grid-2">
    <!-- 다가오는 마감일 -->
    <section class="card" aria-labelledby="upcoming-title">
      <div id="upcoming-title" class="card-title">다가오는 마감일</div>

      <ul class="list">
        {% for title, course_title, due_at in upcoming %}
          <li>
            <div>
              <div class="list-title">{{ title }}</div>
              <div class="list-sub">{{ course_title }}</div>
            </div>
            <div class="badge danger">{{ due_at.strftime('%m/%d %H:%M') }}</div>
          </li>
        {% else %}
          <li class="muted">다가오는 일정이 없습니다.</li>
        {% endfor %}
      </ul>

      <a class="btn-ghost" href="{{ url_for('schedule_page') }}">전체 일정 보기</a>
    </section>

    <!-- 최근 활동 -->
    <section class="card" aria-labelledby="recent-activity-title">
      <div id="recent-activity-title" class="card-title">최근 활동</div>

      <ul class="activity">
        {% for ts, text in recent %}
          <li>
            <span class="dot lg" aria-hidden="true"></span>
            <div>
              <div>{{ text }}</div>
              <div class="muted small">{{ ts.strftime('%m/%d %H:%M') }}</div>
            </div>
          </li>
        {% else %}
          <li class="muted">최근 활동이 없습니다.</li>
        {% endfor %}
      </ul>
    </section>
  </div>
{% endblock %}