{% extends "base.html" %}
{% block title %}성적{% endblock %}
{% block header %}성적{% endblock %}
{% block content %}

{% if overall_avg is not none %}
  <div class="card" style="margin-bottom:16px">
    <div class="title">전체 평균</div>
    <div style="font-size:28px; font-weight:700">{{ overall_avg }}%</div>
  </div>
{% endif %}

<div class="card">
  <div class="title">강좌별 성적 요약</div>
  <table class="tbl">
    <thead>
      <tr>
        <th>강좌</th>
        <th>과제수</th>
        <th>제출</th>
        <th>채점됨</th>
        <th>정시</th>
        <th>지각</th>
        <th>미제출</th>
        <th>진행률</th>
        <th>평균</th>
        <th>등급</th>
      </tr>
    </thead>
    <tbody>
      {% for c in cards %}
      <tr>
        <td><b>{{ c.course.title }}</b></td>
        <td class="muted">{{ c.total }}</td>
        <td>{{ c.submitted }}</td>
        <td>{{ c.graded }}</td>
        <td>{{ c.ontime }}</td>
        <td>{{ c.late }}</td>
        <td>{{ c.missing }}</td>
        <td><span class="chip">{{ c.completion }}%</span></td>
        <td>{% if c.avg_pct is not none %}<b>{{ c.avg_pct }}%</b>{% else %}-{% endif %}</td>
        <td><span class="chip">{{ c.letter }}</span></td>
      </tr>
      <tr>
        <td colspan="10" style="background:#fafafa">
          <div class="muted" style="margin:6px 0">과제 상세</div>
          <table class="tbl" style="margin:0">
            <thead>
              <tr><th>과제</th><th>마감</th><th>제출시각</th><th>상태</th><th>점수</th><th>백분율</th><th>첨부</th></tr>
            </thead>
            <tbody>
              {% for row in details[c.course.id] %}
              <tr>
                <td><b>{{ row.a.title }}</b></td>
                <td>{% if row.a.due_at %}{{ row.a.due_at|dt_kr }}{% else %}-{% endif %}</td>
                <td>{% if row.s and row.s.submitted_at %}{{ row.s.submitted_at|dt_kr }}{% else %}-{% endif %}</td>
                <td>
                  {% if row.late_badge %}<span class="chip chip-warn">지각</span>{% endif %}
                  <span class="chip">{{ row.status }}</span>
                </td>
                <td>
                  {% if row.s and row.s.score is not none %}
                    {{ row.s.score }} / {{ row.a.total_score or 100 }}
                  {% else %}-{% endif %}
                </td>
                <td>{% if row.pct is not none %}{{ row.pct }}%{% else %}-{% endif %}</td>
                <td>
                  {% if row.s and row.s.file_url %}
                    <a href="{{ row.s.file_url }}" target="_blank">다운로드</a>
                  {% else %}-{% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="10" class="muted">표시할 데이터가 없습니다.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}